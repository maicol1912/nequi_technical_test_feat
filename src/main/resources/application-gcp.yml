spring:
  application:
    name: franchise-management-api

  springdoc:
    api-docs:
      enabled: true
      path: /v3/api-docs
    swagger-ui:
      enabled: true
      path: /swagger-ui.html
      try-it-out-enabled: true
      operations-sorter: alpha
      tags-sorter: alpha
      display-request-duration: true
      display-operation-id: true
    show-actuator: true
    group-configs:
      - group: franchise-api
        display-name: Franchise Management API
        paths-to-match: /api/v1/**
        packages-to-scan: com.nequi.franchise_api
      - group: actuator
        display-name: Actuator API
        paths-to-match: /actuator/**

  r2dbc:
    url: r2dbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    host: ${DB_HOST}
    username: ${DB_USERNAME:franchise_user}
    password: ${DB_PASSWORD:franchise1234**}
    pool:
      initial-size: 5
      max-size: 20
      max-idle-time: 30m
      validation-query: SELECT 1

  flyway:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    user: ${DB_USERNAME:franchise_user}
    password: ${DB_PASSWORD:franchise1234**}
    locations: classpath:db/migration
    baseline-on-migrate: true
    repair: true
    validate-on-migrate: true

  jackson:
    default-property-inclusion: NON_NULL
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

  server:
    port: ${SERVER_PORT:8080}
    error:
      include-message: always
      include-binding-errors: always
    shutdown: graceful

  management:
    endpoints:
      web:
        exposure:
          include: health,info,metrics,prometheus
        base-path: /actuator
    endpoint:
      health:
        show-details: always
    metrics:
      export:
        prometheus:
          enabled: true
    health:
      r2dbc:
        enabled: true

  app:
    name: Franchise Management API
    version: 1.0.0
    description: Reactive API for managing franchises, branches, and products
    cors:
      allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:4200}
      allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
      allowed-headers: "*"
      allow-credentials: true
    database:
      connection-timeout: 30s
      statement-timeout: 60s
    resilience:
      retry:
        max-attempts: 3
        wait-duration: 1s
      circuit-breaker:
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10s
        sliding-window-size: 10

  logging:
    level:
      com.nequi.franchise: ${LOG_LEVEL:INFO}
      org.springframework.data.r2dbc: ${LOG_LEVEL:INFO}
      io.r2dbc.postgresql: ${LOG_LEVEL:INFO}
      org.springframework.web.reactive: ${LOG_LEVEL:INFO}
      org.flywaydb: ${LOG_LEVEL:INFO}
    pattern:
      console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"