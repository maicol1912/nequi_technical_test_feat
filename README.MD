# ğŸ¢ Franquicias API â€“ Prueba TÃ©cnica NEQUI

API de gestiÃ³n de franquicias, sucursales y productos desarrollada con **arquitectura hexagonal**, soporte **reactivo** y un enfoque en **mejores prÃ¡cticas** para garantizar escalabilidad, mantenibilidad y despliegue en la nube.

---

## ğŸ“ Arquitectura

La API sigue una **arquitectura hexagonal (Ports & Adapters)**, que promueve la modularidad y la separaciÃ³n de responsabilidades.

```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE LAYER                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web Layer     â”‚   Persistence   â”‚     Configuration       â”‚
â”‚   (Controllers) â”‚    (R2DBC)      â”‚     (Properties)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APPLICATION LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Use Cases          â”‚         Services                  â”‚
â”‚   (Input Ports)         â”‚      (Business Logic)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      DOMAIN LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Models            â”‚       Output Ports                â”‚
â”‚   (Domain Entities)     â”‚     (Repository Interfaces)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›  Stack TecnolÃ³gico

- **Framework**: Spring Boot 3.2 + Spring WebFlux (Reactivo)
- **Lenguaje**: Java 21 (LTS)
- **Base de Datos**: PostgreSQL 15
- **ORM Reactivo**: Spring Data R2DBC
- **Migraciones**: Flyway
- **DocumentaciÃ³n**: OpenAPI 3 + Swagger UI
- **ContainerizaciÃ³n**: Docker + Docker Compose
- **Cloud**: Google Cloud Platform (GCP)
- **IaC**: Terraform

---

## ğŸš€ Funcionalidades

### 1ï¸âƒ£ GestiÃ³n de Franquicias
- Crear, actualizar y listar franquicias.
- Consultar franquicia por ID.
- Obtener franquicia con sucursales y productos asociados.

### 2ï¸âƒ£ GestiÃ³n de Sucursales
- Agregar sucursal a una franquicia.
- Actualizar datos de una sucursal.
- Listar sucursales de una franquicia.
- Obtener sucursal con sus productos.

### 3ï¸âƒ£ GestiÃ³n de Productos
- Agregar producto a una sucursal.
- Actualizar informaciÃ³n de producto.
- Modificar stock de producto.
- Eliminar producto.
- Consultar productos por sucursal.

### 4ï¸âƒ£ Reportes
- Producto con mayor stock por sucursal (optimizado con vista en BD).
- Consultas reactivas con R2DBC.

---

## ğŸŒ Endpoints Principales

### Franquicias
| MÃ©todo | Endpoint                                    | DescripciÃ³n                               |
|--------|---------------------------------------------|-------------------------------------------|
| POST   | `/api/v1/franquicias`                      | Crear franquicia                          |
| GET    | `/api/v1/franquicias`                      | Listar franquicias                        |
| GET    | `/api/v1/franquicias/{id}`                 | Obtener franquicia                        |
| PUT    | `/api/v1/franquicias/{id}`                 | Actualizar franquicia                     |
| GET    | `/api/v1/franquicias/{id}/completa`        | Franquicia con sucursales y productos     |
| GET    | `/api/v1/franquicias/{id}/productos-max-stock` | Producto con mÃ¡s stock                |

### Sucursales
| MÃ©todo | Endpoint                                    | DescripciÃ³n                               |
|--------|---------------------------------------------|-------------------------------------------|
| POST   | `/api/v1/franquicias/{id}/sucursales`      | Agregar sucursal                          |
| GET    | `/api/v1/sucursales/{id}`                  | Obtener sucursal                          |
| PUT    | `/api/v1/sucursales/{id}`                  | Actualizar sucursal                       |
| GET    | `/api/v1/sucursales/{id}/productos`        | Productos de sucursal                     |

### Productos
| MÃ©todo | Endpoint                                    | DescripciÃ³n                               |
|--------|---------------------------------------------|-------------------------------------------|
| POST   | `/api/v1/sucursales/{id}/productos`        | Agregar producto                          |
| GET    | `/api/v1/productos/{id}`                   | Obtener producto                          |
| PUT    | `/api/v1/productos/{id}`                   | Actualizar producto                       |
| PATCH  | `/api/v1/productos/{id}/stock`             | Modificar stock                           |
| DELETE | `/api/v1/productos/{id}`                   | Eliminar producto                         |

---

## ğŸ’» Desarrollo Local

### ğŸ“‹ Prerrequisitos
- Docker v20+
- Docker Compose v2+
- Java 21 (opcional, si se corre sin Docker)
- Maven 3.9+ (opcional, si se corre sin Docker)

### âš¡ Pasos de InstalaciÃ³n
1. **Clonar el repositorio**:
   ```bash
   git clone https://github.com/maicol1912/nequi_api_technical_test
   cd nequi_api_technical_test
   ```

2. **Levantar base de datos y API**:
   ```bash
   docker-compose up --build -d
   ```

3. **Verificar que el servicio estÃ© activo**:
   ```bash
   curl http://localhost:8080/healthcheck
   ```

   **Respuesta esperada**:
   ```json
   {
     "status": "UP",
     "application": "franchise-api",
     "version": "1.0.0",
     "timestamp": "2025-08-08T14:25:31.123"
   }
   ```

---

## ğŸ“œ DocumentaciÃ³n API
- **Swagger UI**: [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)
- **OpenAPI JSON**: [http://localhost:8080/v3/api-docs](http://localhost:8080/v3/api-docs)

---

## ğŸ—„ Acceso a Base de Datos (PgAdmin)
- **URL**: [http://localhost:5050](http://localhost:5050)
- **Usuario**: `admin@example.com`
- **ContraseÃ±a**: `admin123`
- **ConexiÃ³n a DB**:
    - Host: `postgres`
    - Puerto: `5432`
    - Usuario: `franchise_user`
    - ContraseÃ±a: `franchise1234**`
    - Base de datos: `franchise_nequi`

---

## âš™ï¸ Variables de Entorno
Definidas en `docker-compose.yml` (pueden sobreescribirse):

```bash
SPRING_PROFILES_ACTIVE=docker
DB_HOST=postgres
DB_PORT=5432
DB_NAME=franchise_nequi
DB_USERNAME=franchise_user
DB_PASSWORD=franchise1234**
SERVER_PORT=8080
```

---

## ğŸ›  Comandos Ãštiles
```bash
# Ver logs de la API
docker logs -f franchise-management-api

# Reiniciar servicios
docker-compose restart

# Apagar servicios
docker-compose down

# Apagar y eliminar volÃºmenes
docker-compose down -v
```

---

## ğŸ“¦ Despliegue
- Listo para ejecutarse en **Google Cloud Platform (GCP)**.
- Manejo de infraestructura con **Terraform**.
- ConfiguraciÃ³n desacoplada por perfiles (`application-{profile}.yml`).

---
ğŸ§ª Testeo en ProducciÃ³n
La API se encuentra desplegada y disponible para pruebas en el entorno productivo.
Puedes explorar y ejecutar los endpoints directamente desde Swagger UI en el siguiente enlace:

ğŸ”— Swagger UI â€“ ProducciÃ³n
https://franchise-api-prod-api-523802894907.us-central1.run.app/webjars/swagger-ui/index.html